{% if EDXAPP_SCORM_PKG_STORAGE_DIR %}
    location ~ ^/{{ EDXAPP_MEDIA_URL }}/{{ EDXAPP_SCORM_PKG_STORAGE_DIR }}/(?P<file>.*) {
        add_header 'Access-Control-Allow-Origin' $cors_origin;
        add_header 'Access-Control-Allow-Credentials' 'true';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';

        root {{ edxapp_media_dir }}/{{ EDXAPP_SCORM_PKG_STORAGE_DIR }};
        try_files /$file =404;
        expires 604800s;
    }
{% endif %}
{% if S3_DJFS_PYFS_BUCKET %}

    location ^~ /media/djfs-pyfs/ {
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header Authorization '';
        proxy_set_header Host {{ S3_DJFS_PYFS_BUCKET }}.s3.amazonaws.com;
        proxy_hide_header x-amz-id-2;
        proxy_hide_header x-amz-request-id;
        proxy_hide_header x-amz-meta-server-side-encryption;
        proxy_hide_header x-amz-server-side-encryption;
        proxy_hide_header Set-Cookie;
        proxy_ignore_headers Set-Cookie;
        proxy_intercept_errors on;
        add_header Cache-Control max-age=31536000;
        proxy_pass https://{{ S3_DJFS_PYFS_BUCKET }}.s3.amazonaws.com/{{ S3_DJFS_PYFS_BUCKET }}/;
    }
{% endif %}
